<!-- inventory/fasteners_list.html -->
{% extends "inventory/base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è ‚Äî –£—á—ë—Ç{% endblock %}

{% block content %}
<!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π -->
{% if messages %}
  <div class="messages">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}

<h1>–ö—Ä–µ–ø—ë–∂</h1>
<form method="get" class="mb-4">
  <div class="input-group">
    <input type="text" name="q" value="{{ request.GET.q }}"
           class="form-control" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –æ–ø–∏—Å–∞–Ω–∏—é...">
    <button class="btn btn-outline-secondary" type="submit"> –ù–∞–π—Ç–∏</button>
  </div>
</form>

{% if items %}
  <div class="row">
    {% for item in items %}
      <div class="col-md-6 mb-3">
        <div class="card">
          <div class="card-body">
          {% if item.image %}
            <a href="#" onclick="openModal('{{ item.image.url }}', '{{ item.name }}'); return false;">
              <img src="{{ item.image.url }}" class="img-fluid rounded mb-2" alt="{{ item.name }}" style="max-height: 150px; object-fit: contain; cursor: zoom-in;">
            </a>
          {% else %}
            <div class="text-muted mb-2">üì∑ –ë–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
          {% endif %}

            <h5 class="card-title">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ: {{ item.name }}</h5>
            <p class="card-text">
              <p class="card-text">
              <strong>
                <span {% if item.quantity <= item.min_quantity %}style="color: red; font-weight: bold;"{% endif %}>
                  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:
                </span>
              </strong>
              <span {% if item.quantity <= item.min_quantity %}style="color: red; font-weight: bold;"{% endif %}>
                {{ item.quantity }}
              </span>
              <br>
              <strong>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫:</strong> {{ item.min_quantity}}<br>
              <strong>–°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–∫—É–ø:</strong> {{ item.link }}<br>
              {% if item.description %}
                <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ item.description }}
              {% else %}
                <em>–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è</em>
              {% endif %}
            </p>

            <!-- –§–æ—Ä–º–∞ –∑–∞–ø—Ä–æ—Å–∞ -->
            <form method="post" action="{% url 'create_request_fasteners' item.pk %}">
              {% csrf_token %}
              <div class="input-group mb-2">
                <label class="input-group-text" for="quantity_{{ item.pk }}">–ö–æ–ª-–≤–æ</label>
                <input type="number" name="quantity" min="1" max="{{ item.quantity }}" id="quantity_{{ item.pk }}" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">
              </div>
              <button type="submit" class="btn btn-sm btn-primary">–ó–∞–ø—Ä–æ—Å–∏—Ç—å</button>
            </form>

            <!-- –ö–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ -->
            {% if user.is_staff %}
            <div class="mt-2">
              <a href="{% url 'edit_fasteners' item.pk %}" class="btn btn-sm btn-outline-primary">–ò–∑–º–µ–Ω–∏—Ç—å</a>
              <a href="{% url 'delete_fasteners' item.pk %}" class="btn btn-sm btn-outline-danger">–£–¥–∞–ª–∏—Ç—å</a>
            </div>
            {% endif %}

          </div> <!-- card-body -->
        </div> <!-- card -->
      </div> <!-- col-md-6 -->
    {% endfor %}
  </div>
{% else %}
  <p class="text-muted">
    {% if query %}
      –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É "{{ query }}".
    {% else %}
      –ù–µ—Ç –∫—Ä–µ–ø–µ–∂–∞.
    {% endif %}
  </p>
{% endif %}

{% endblock %}